#!/usr/bin/env bash
# Email: xealea@proton.me

# VAR SET NO = NOT ACTIVE | YES = ACTIVE
PICOM=YES
XLOCK=YES
QTILE_RELOAD=YES

# Init DIR
DIR="$HOME/.config"

# Kill already running process
for _prs in xsettingsd ksuperkey; do
    pid=$(pidof $_prs)
    [[ -n $pid ]] && kill -9 $pid
done

# Environment variables
export QT_QPA_PLATFORMTHEME="gtk3"
export VISUAL="nvim"
export EDITOR="geany"
export TERM="alacritty"
export HISTCONTROL="ignoredups:erasedups"
export XCURSOR_THEME="oreo_white_cursors xclock"

# Set other env
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"

# Xdeb for voidlinux
export XDEB_OPT_DEPS="true"
export XDEB_OPT_SYNC="true"
export XDEB_OPT_WARN_CONFLICT="true"
export XDEB_OPT_FIX_CONFLICT="true"

# Nyoom
export NVIM_APPNAME="nvim"

# Path my script
export PATH="$DIR/nvim/bin:$HOME/.local/bin:$PATH"

# polkit agent
if ! pidof xfce-polkit; then
    exec /usr/lib/xfce-polkit/xfce-polkit &
fi

# qtile
if [ $QTILE_RELOAD = "YES" ]; then
    python -m py_compile ~/.config/qtile/config.py &
fi

# picom
if [ $PICOM = "YES" ]; then
    picom --config "$DIR/picom.conf" &
fi

# lockscreen
if [ $XLOCK = "YES" ]; then
	xautolock -time 5 -locker "xscreensaver-command -lock" -detectsleep &
fi

# Run processes 
~/.fehbg &
xfsettingsd &
xfce4-power-manager &
dbus-run-session pipewire &
xsetroot -cursor_name left_ptr &
dunst -config "$DIR/dunst/dunstrc" &
xsettingsd --config="$DIR/xsettingsd/xsettingsd.conf" &

# run without login manager
exec dbus-run-session qtile start
