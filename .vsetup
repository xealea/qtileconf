#!/usr/bin/env bash
# Email: xealea@proton.me

# VAR SET NO = NOT ACTIVE | YES = ACTIVE
PICOM=NO
QTILE_RELOAD=YES

# Init DIR
DIR="$HOME/.config"

# Kill already running process
_ps=(xsettingsd ksuperkey)
for _prs in "${_ps[@]}"; do
	if [[ `pidof ${_prs}` ]]; then
		killall -9 ${_prs}
	fi
done

# Environment variables
export QT_QPA_PLATFORMTHEME="gtk3"
export VISUAL="nvim"
export EDITOR="geany"
export TERM="alacritty"
export HISTCONTROL="ignoredups:erasedups"
export XCURSOR_THEME="oreo_white_cursors xclock"

# Set other env
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"

# Xdeb for voidlinux
export XDEB_OPT_DEPS="true"
export XDEB_OPT_SYNC="true"
export XDEB_OPT_WARN_CONFLICT="true"
export XDEB_OPT_FIX_CONFLICT="true"

# Nyoom
export NVIM_APPNAME="nvim"

# Path my script
export PATH=""$DIR"/nvim/bin:$HOME/.local/bin:$PATH"

# polkit agent
if [[ ! `pidof xfce-polkit` ]]; then
	exec /usr/lib/xfce-polkit/xfce-polkit &
fi

# Run processes
exec ~/.fehbg &
xfsettingsd &
xrdb ~/.Xresources &
xfce4-power-manager &
dbus-run-session pipewire &
if [ $QTILE_RELOAD = "YES" ];
then
	python -m py_compile ~/.config/qtile/config.py &
fi
xsettingsd --config="$DIR"/xsettingsd/xsettingsd.conf &

# Enable Super Keys For Menu
ksuperkey -e 'Super_L=Alt_L|F1' &
superkey -e 'Super_R=Alt_L|F1' &
xsetroot -cursor_name left_ptr &

# Start dunst & picom
if [ $PICOM = "YES" ];
then
	picom --config  "$DIR"/picom.conf &
fi
dunst -config "$DIR"/dunst/dunstrc &

# X lock
xscreensaver -no-splash &
xautolock -time 5 -locker "xscreensaver-command -lock" -detectsleep &

# run without login manager
exec dbus-run-session qtile start
